<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>Chúc bé yêu 20/10 vui vẻ !!!</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        html, body {
            height: 100%;
            padding: 0;
            margin: 0;
            background: black;
            font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #fff;
            overflow: hidden;
        }
        canvas#pinkboard {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            display: block;
            cursor: none; /* optional: hide cursor to emphasize heart */
        }

        .stage{
            position: relative;
            z-index: 2; /* above canvas */
            min-height:100%;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:flex-start;
            padding-top:6vh;
            text-align:center;
            pointer-events:none;
        }

        h1.title{
            margin:0;
            font-size:clamp(26px,4vw,46px);
            color:#ffd1e3;
            text-shadow: 0 6px 20px rgba(0,0,0,0.6), 0 0 18px rgba(255,128,170,0.25);
            letter-spacing:1px;
            background: linear-gradient(90deg, #fff 0%, #ffd1e3 60%, #ff99c2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom:18px;
            pointer-events:auto;
        }

        .card{
            max-width:900px;
            width:85%;
            background: rgba(0,0,0,0.22);
            backdrop-filter: blur(6px);
            border-radius:16px;
            padding:22px 26px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.06);
            pointer-events:auto;
        }

        .typed{
            font-size:clamp(16px,2.1vw,20px);
            line-height:1.75;
            color:#ffeef6;
            min-height:140px;
            text-align:left;
            white-space:pre-wrap;
            overflow-wrap:break-word;
            position:relative;
            word-break:break-word;
        }

        /* caret */
        .caret{
            display:inline-block;
            width:2px;
            height:1.15em;
            background:#fff;
            margin-left:3px;
            vertical-align:bottom;
            animation: blink 1s steps(2,start) infinite;
        }
        @keyframes blink{50%{opacity:0}100%{opacity:1}}

        @media (max-width:520px){
            .card{ padding:16px; border-radius:12px; }
            .typed{ font-size:14px; min-height:120px; }
        }
    </style>
</head>
<body>

<canvas id="pinkboard" aria-hidden="true"></canvas>

<div class="stage" aria-live="polite">
    <h1 class="title">Chúc bé yêu 20/10 vui vẻ !!!</h1>

    <div class="card" role="article" aria-label="Lời chúc">
        <div id="typed" class="typed" aria-atomic="true"></div><span id="caret" class="caret" aria-hidden="true"></span>
    </div>
</div>

<script>
    /* ---------- Heart particles background (particles spawn at emitPoint which follows mouse) ---------- */
    var settings = {
        particles: {
            length: 500,
            duration: 2,
            velocity: 100,
            effect: -0.75,
            size: 28
        }
    };

    // RAF polyfill
    (function(){var last=0;var v=['ms','moz','webkit','o'];for(var i=0;i<v.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[v[i]+'RequestAnimationFrame'];window.cancelAnimationFrame=window[v[i]+'CancelAnimationFrame']||window[v[i]+'CancelRequestAnimationFrame']}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(cb){var now=Date.now();var t=Math.max(0,16-(now-last));var id=setTimeout(function(){cb(now+t)},t);last=now+t;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}}());

    // Basic point class
    var Point = (function(){
        function Point(x,y){ this.x = (typeof x !== 'undefined') ? x : 0; this.y = (typeof y !== 'undefined') ? y : 0; }
        Point.prototype.clone = function(){ return new Point(this.x, this.y); };
        Point.prototype.length = function(len){ if(typeof len === 'undefined') return Math.sqrt(this.x*this.x + this.y*this.y); this.normalize(); this.x *= len; this.y *= len; return this; };
        Point.prototype.normalize = function(){ var l = this.length(); if (l === 0) { this.x = 0; this.y = 0; return this; } this.x /= l; this.y /= l; return this; };
        return Point;
    })();

    var Particle = (function(){
        function Particle(){ this.position = new Point(); this.velocity = new Point(); this.acceleration = new Point(); this.age = 0; }
        Particle.prototype.initialize = function(x,y,dx,dy){ this.position.x = x; this.position.y = y; this.velocity.x = dx; this.velocity.y = dy; this.acceleration.x = dx * settings.particles.effect; this.acceleration.y = dy * settings.particles.effect; this.age = 0; };
        Particle.prototype.update = function(dt){ this.position.x += this.velocity.x * dt; this.position.y += this.velocity.y * dt; this.velocity.x += this.acceleration.x * dt; this.velocity.y += this.acceleration.y * dt; this.age += dt; };
        Particle.prototype.draw = function(ctx,image){ function ease(t){ return (--t)*t*t + 1; } var size = image.width * ease(this.age / settings.particles.duration); ctx.globalAlpha = Math.max(0, 1 - this.age / settings.particles.duration); ctx.drawImage(image, this.position.x - size/2, this.position.y - size/2, size, size); };
        return Particle;
    })();

    var ParticlePool = (function(){
        var particles, firstActive = 0, firstFree = 0, duration = settings.particles.duration;
        function ParticlePool(length){ particles = new Array(length); for(var i=0;i<length;i++) particles[i] = new Particle(); }
        ParticlePool.prototype.add = function(x,y,dx,dy){ particles[firstFree].initialize(x,y,dx,dy); firstFree++; if(firstFree===particles.length) firstFree=0; if(firstActive===firstFree) firstActive++; if(firstActive===particles.length) firstActive=0; };
        ParticlePool.prototype.update = function(dt){
            var i;
            if(firstActive < firstFree){ for(i=firstActive;i<firstFree;i++) particles[i].update(dt); }
            if(firstFree < firstActive){ for(i=firstActive;i<particles.length;i++) particles[i].update(dt); for(i=0;i<firstFree;i++) particles[i].update(dt); }
            while(particles[firstActive].age >= duration && firstActive != firstFree){ firstActive++; if(firstActive===particles.length) firstActive=0; }
        };
        ParticlePool.prototype.draw = function(ctx,image){
            var i;
            if(firstActive < firstFree){ for(i=firstActive;i<firstFree;i++) particles[i].draw(ctx,image); }
            if(firstFree < firstActive){ for(i=firstActive;i<particles.length;i++) particles[i].draw(ctx,image); for(i=0;i<firstFree;i++) particles[i].draw(ctx,image); }
        };
        return ParticlePool;
    })();

    /* main */
    (function(canvas){
        var ctx = canvas.getContext('2d');
        var particles = new ParticlePool(settings.particles.length);
        var particleRate = settings.particles.length / settings.particles.duration;
        var time;

        // emit point in canvas coordinates (scaled by DPR internally)
        var emit = { x: 0, y: 0 };
        var emitTarget = { x: 0, y: 0 }; // for smooth follow
        var followMouse = false;
        var lastMoveTimer = null;

        function pointOnHeart(t){
            return new Point(
                160 * Math.pow(Math.sin(t), 3),
                130 * Math.cos(t) - 50 * Math.cos(2*t) - 20 * Math.cos(3*t) - 10 * Math.cos(4*t) + 25
            );
        }

        var image = (function(){
            var c = document.createElement('canvas'), cx = c.getContext('2d');
            c.width = settings.particles.size;
            c.height = settings.particles.size;
            function to(t){ var p = pointOnHeart(t); p.x = settings.particles.size/2 + p.x * settings.particles.size / 350; p.y = settings.particles.size/2 - p.y * settings.particles.size / 350; return p; }
            cx.beginPath(); var t = -Math.PI; var pt = to(t); cx.moveTo(pt.x, pt.y);
            while(t < Math.PI){ t += 0.01; pt = to(t); cx.lineTo(pt.x, pt.y); }
            cx.closePath();
            var g = cx.createLinearGradient(0,0,c.width,c.height);
            g.addColorStop(0, "#ff8bbd"); g.addColorStop(1, "#ff5fa0");
            cx.fillStyle = g; cx.fill();
            var img = new Image(); img.src = c.toDataURL(); return img;
        })();

        // helper to set default center (in internal canvas coords)
        function setEmitToCenter() {
            var rect = canvas.getBoundingClientRect();
            var dpr = window.devicePixelRatio || 1;
            emitTarget.x = (rect.width/2) * dpr;
            emitTarget.y = (rect.height/2) * dpr;
        }

        // handle mouse/touch movement: set emitTarget to pointer position
        function onPointerMove(clientX, clientY) {
            var rect = canvas.getBoundingClientRect();
            var dpr = window.devicePixelRatio || 1;
            // clamp inside canvas
            var cx = Math.max(0, Math.min(rect.width, clientX - rect.left));
            var cy = Math.max(0, Math.min(rect.height, clientY - rect.top));
            emitTarget.x = cx * dpr;
            emitTarget.y = cy * dpr;
            followMouse = true;
            // clear previous timer
            if (lastMoveTimer) clearTimeout(lastMoveTimer);
            // when pointer stops moving for 1.2s, revert followMouse to false and go back to center smoothly
            lastMoveTimer = setTimeout(function(){ followMouse = false; setEmitToCenter(); }, 1200);
        }

        // pointer events
        window.addEventListener('mousemove', function(e){ onPointerMove(e.clientX, e.clientY); }, {passive:true});
        window.addEventListener('touchmove', function(e){ if (e.touches && e.touches[0]) { onPointerMove(e.touches[0].clientX, e.touches[0].clientY); } }, {passive:true});
        window.addEventListener('mouseleave', function(){ followMouse = false; setEmitToCenter(); if (lastMoveTimer) clearTimeout(lastMoveTimer); });
        window.addEventListener('blur', function(){ followMouse = false; setEmitToCenter(); if (lastMoveTimer) clearTimeout(lastMoveTimer); });

        function render(){
            requestAnimationFrame(render);
            var newTime = Date.now() / 1000;
            var dt = newTime - (time || newTime);
            time = newTime;

            // smooth emit follow
            var lerp = 0.22;
            emit.x += (emitTarget.x - emit.x) * lerp;
            emit.y += (emitTarget.y - emit.y) * lerp;

            // clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // spawn particles around emit with some spread for nicer look
            var amount = particleRate * dt;
            for (var i=0;i<amount;i++){
                var pos = pointOnHeart(Math.PI - 2*Math.PI*Math.random());
                var dir = pos.clone().length(settings.particles.velocity);
                // add slight random offset to where particle originates so heart looks filled
                var jitter = (Math.random() - 0.5) * 12;
                var jitterY = (Math.random() - 0.5) * 12;
                particles.add(emit.x + pos.x + jitter, emit.y - pos.y + jitterY, dir.x, -dir.y);
            }

            particles.update(dt);
            particles.draw(ctx, image);
        }

        // resize handling (support DPR)
        function onResize(){
            var rect = canvas.getBoundingClientRect();
            var dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.setTransform(dpr,0,0,dpr,0,0);
            setEmitToCenter();
            emit.x = emitTarget.x; emit.y = emitTarget.y; // place immediately at center on resize
        }
        window.addEventListener('resize', onResize, false);

        // init
        setTimeout(function(){ onResize(); render(); }, 10);
    })(document.getElementById('pinkboard'));

    /* ---------- Typing effect with caret (caret stays inline after text) ---------- */
    var typedEl = document.getElementById('typed');
    var caret = document.getElementById('caret');

    var message = "Hôm nay là ngày 20/10, anh chúc bé yêu của anh luôn luôn xinh đẹp, nhiều tiền và gặp nhiều may mắn trong các công việc và học tập sắp tới. Anh cũng xin lỗi bé thật nhiều vì một lần nữa đã khiến em cũng thất vọng thật nhiều. Anh biết là điều này đã khiến em hoài nghi tình cảm của anh, anh cũng biết là làm như thế này cũng chẳng thể gỡ gạc được điều gì. Tuy nhiên, anh chỉ muốn bày tỏ một điều với em là ANH YÊU EM NHIỀU LẮM!!!";

    var index = 0;
    var typingSpeed = 24; // ms per char
    var delayBeforeStart = 700;

    typedEl.textContent = ""; // start empty

    function typeStep(){
        if (index <= message.length - 1){
            typedEl.textContent += message.charAt(index);
            index++;
            typedEl.parentNode.scrollTop = typedEl.parentNode.scrollHeight;
            setTimeout(typeStep, typingSpeed + (Math.random()*18));
        } else {
            caret.style.animation = "none";
            setTimeout(function(){ caret.style.opacity = "0"; },1200);
        }
    }

    document.addEventListener('click', function(){
        if (index < message.length) {
            while (index < message.length) {
                typedEl.textContent += message.charAt(index);
                index++;
            }
            caret.style.animation = "none";
            setTimeout(function(){ caret.style.opacity = "0"; },900);
        }
    }, { once:false });

    setTimeout(function(){
        document.querySelector('.title').style.filter = "drop-shadow(0 10px 30px rgba(255,90,150,0.18))";
        typeStep();
    }, delayBeforeStart);
</script>

</body>
</html>
